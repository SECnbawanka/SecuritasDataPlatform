use schema ODS_KONTROLSYS_NO.DBO;

SHOW masking policies;

CREATE OR REPLACE masking policy MP_DECRYPT_BINARY_KONTROLSYS as (VAL BINARY(8388608))   returns BINARY(8388608) ->  CASE    WHEN IS_ROLE_IN_SESSION('DECRYPT_ODS_KONTROLSYS_NO') = TRUE      THEN DECRYPT(VAL,(SELECT PASSPHRASE FROM DW.CONTROL.KEYSTORE WHERE TABLE_CATALOG=CURRENT_DATABASE()),(SELECT KEY_VALUE FROM DW.CONTROL.KEYSTORE WHERE TABLE_CATALOG=CURRENT_DATABASE()),(SELECT ADVANCED_ENCRYPTION_STD FROM DW.CONTROL.KEYSTORE WHERE TABLE_CATALOG=CURRENT_DATABASE()))    ELSE NULL  END  ;

--drop masking policy MP_DECRYPT_BINARY_KONTROLSYS ;

CALL DW.CONTROL.APPLY_MASKING('MP_DECRYPT_BINARY_KONTROLSYS','ODS_KONTROLSYS_NO');

DESC MASKING POLICY  MP_DECRYPT_BINARY_KONTROLSYS

